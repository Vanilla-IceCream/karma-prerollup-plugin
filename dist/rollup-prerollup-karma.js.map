{"version":3,"file":"rollup-prerollup-karma.js","sources":["../src/index.js"],"sourcesContent":["const { rollup } = require('rollup');\n\nconst SOURCEMAPPING_URL = 'sourceMappingURL';\n\nconst createRollupPreprocessor = (args, options = {}, logger) => {\n  const log = logger.create('preprocessor.prerollup');\n\n  return (content, file, done) => {\n    log.debug(`Processing \"${file.originalPath}\".`);\n\n    try {\n      options.entry = file.originalPath;\n\n      rollup(options)\n        .then(bundle => {\n          let { code, map } = bundle.generate(options);\n\n          if (options.sourceMap === 'inline') code += `\\n//# ${SOURCEMAPPING_URL}=${map.toUrl()}`;\n          if (options.sourceMap) file.sourceMap = map;\n\n          done(null, code);\n        })\n        .catch(error => {\n          log.error(`${error.message}\\n at ${file.originalPath}\\n${error.stack}`);\n          done(error);\n        });\n    } catch (error) {\n      log.error(`${error.message}\\n at ${file.originalPath}`);\n      done(error);\n    }\n  };\n};\n\ncreateRollupPreprocessor.$inject = ['args', 'config.prerollupPreprocessor', 'logger'];\n\nmodule.exports = { 'preprocessor:prerollup': ['factory', createRollupPreprocessor] };\n"],"names":["const"],"mappings":";;AAAK,OAAW,GAAG,OAAO,CAAC,QAAQ,CAAC;AAA5B,IAAA,MAAM,cAAR;;AAENA,IAAM,iBAAiB,GAAG,kBAAkB,CAAC;;AAE7CA,IAAM,wBAAwB,GAAG,UAAC,IAAI,EAAE,OAAY,EAAE,MAAM,EAAE;mCAAf,GAAG,EAAE;;EAClDA,IAAM,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,wBAAwB,CAAC,CAAC;;EAEpD,OAAO,UAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE;IAC3B,GAAG,CAAC,KAAK,EAAC,eAAa,IAAE,IAAI,CAAC,YAAY,CAAA,QAAG,EAAE,CAAC;;IAEhD,IAAI;MACF,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC;;MAElC,MAAM,CAAC,OAAO,CAAC;SACZ,IAAI,CAAC,UAAA,MAAM,EAAC;UACX,OAAiB,GAAG,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;UAAtC,IAAA,IAAI;UAAE,IAAA,GAAG,WAAX;;UAEJ,IAAI,OAAO,CAAC,SAAS,KAAK,QAAQ,EAAE,EAAA,IAAI,IAAI,QAAO,GAAE,iBAAiB,MAAE,IAAE,GAAG,CAAC,KAAK,EAAE,CAAA,CAAG,EAAA;UACxF,IAAI,OAAO,CAAC,SAAS,EAAE,EAAA,IAAI,CAAC,SAAS,GAAG,GAAG,CAAC,EAAA;;UAE5C,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;SAClB,CAAC;SACD,KAAK,CAAC,UAAA,KAAK,EAAC;UACX,GAAG,CAAC,KAAK,EAAC,CAAG,KAAK,CAAC,OAAO,YAAO,IAAE,IAAI,CAAC,YAAY,CAAA,OAAG,IAAE,KAAK,CAAC,KAAK,CAAA,EAAG,CAAC;UACxE,IAAI,CAAC,KAAK,CAAC,CAAC;SACb,CAAC,CAAC;KACN,CAAC,OAAO,KAAK,EAAE;MACd,GAAG,CAAC,KAAK,EAAC,CAAG,KAAK,CAAC,OAAO,YAAO,IAAE,IAAI,CAAC,YAAY,CAAA,EAAG,CAAC;MACxD,IAAI,CAAC,KAAK,CAAC,CAAC;KACb;GACF,CAAC;CACH,CAAC;;AAEF,wBAAwB,CAAC,OAAO,GAAG,CAAC,MAAM,EAAE,8BAA8B,EAAE,QAAQ,CAAC,CAAC;;AAEtF,MAAM,CAAC,OAAO,GAAG,EAAE,wBAAwB,EAAE,CAAC,SAAS,EAAE,wBAAwB,CAAC,EAAE,CAAC"}